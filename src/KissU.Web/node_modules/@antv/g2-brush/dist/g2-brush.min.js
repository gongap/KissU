!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Brush=e():t.Brush=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){var n=r(1);t.exports=n},function(t,e,r){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=r(2),i=["X","Y","XY","POLYGON"],o=function(){function t(e){n(this,t),this.startPoint=null,this.brushing=!1,this.dragging=!1,this.brushShape=null,this.container=null,this.polygonPath=null,this.style={fill:"#C5D4EB",opacity:.3,lineWidth:1,stroke:"#82A6DD"},this.type="XY",this.dragable=!1,this.dragoffX=0,this.dragoffY=0,this.inPlot=!0,this.xField=null,this.yField=null,this.filter=!e.dragable,this.onBrushstart=null,this.onBrushmove=null,this.onBrushend=null,this.onDragstart=null,this.onDragmove=null,this.onDragend=null,this._init(e)}return t.prototype._init=function(t){a.mix(this,t),this.type=this.type.toUpperCase(),-1===i.indexOf(this.type)&&(this.type="XY");var e=this.canvas;if(e){var r=void 0;e.get("children").map(function(t){return"plotBack"===t.get("type")?(r=t.get("plotRange"),!1):t}),this.plot={start:r.bl,end:r.tr},this.bindCanvasEvent()}if(this.chart){var n=this.chart,o=n.get("coord");this.plot={start:o.start,end:o.end};var s=n._getScales("x"),h=n._getScales("y");this.xScale=this.xField?s[this.xField]:n.getXScale(),this.yScale=this.yField?h[this.yField]:n.getYScales()[0]}},t.prototype.clearEvents=function(){this.onMouseDownListener&&this.onMouseDownListener.remove(),this.onMouseMoveListener&&this.onMouseMoveListener.remove(),this.onMouseupListener&&this.onMouseupListener.remove()},t.prototype.bindCanvasEvent=function(){var t=this.canvas.get("canvasDOM");this.clearEvents(),this.onMouseDownListener=a.addEventListener(t,"mousedown",a.wrapBehavior(this,"_onCanvasMouseDown")),this.onMouseMoveListener=a.addEventListener(t,"mousemove",a.wrapBehavior(this,"_onCanvasMouseMove")),this.onMouseUpListener=a.addEventListener(t,"mouseup",a.wrapBehavior(this,"_onCanvasMouseUp"))},t.prototype._onCanvasMouseDown=function(t){var e=this,r=e.canvas,n=e.type,a=e.brushShape;if(n){var i={x:t.offsetX,y:t.offsetY},o=e.plot&&e.inPlot,s=r.get("canvasDOM"),h=r.get("pixelRatio");if(e.selection&&(e.selection=null),e.dragable&&a&&!a.get("destroyed")){if(a.isHit(i.x*h,i.y*h)){if(s.style.cursor="move",e.selection=a,e.dragging=!0,"X"===n)e.dragoffX=i.x-a.attr("x"),e.dragoffY=0;else if("Y"===n)e.dragoffX=0,e.dragoffY=i.y-a.attr("y");else if("XY"===n)e.dragoffX=i.x-a.attr("x"),e.dragoffY=i.y-a.attr("y");else if("POLYGON"===n){var l=a.getBBox();e.dragoffX=i.x-l.minX,e.dragoffY=i.y-l.minY}o&&e.selection.attr("clip",r.addShape("rect",{attrs:{x:this.plot.start.x,y:this.plot.end.y,width:this.plot.end.x-this.plot.start.x,height:this.plot.start.y-this.plot.end.y,fill:"#fff",fillOpacity:0}})),e.onDragstart&&e.onDragstart(t)}e.prePoint=i}if(!e.dragging){e.onBrushstart&&e.onBrushstart(i);var u=e.container;if(o){var f=e.plot,p=f.start,d=f.end;if(i.x<p.x||i.x>d.x||i.y<d.y||i.y>p.y)return}s.style.cursor="crosshair",e.startPoint=i,e.brushShape=null,e.brushing=!0,u?u.clear():(u=r.addGroup({zIndex:5})).initTransform(),e.container=u,"POLYGON"===n&&(e.polygonPath="M "+i.x+" "+i.y)}}},t.prototype._onCanvasMouseMove=function(t){var e=this,r=e.brushing,n=e.dragging,i=e.type,o=e.plot,s=e.startPoint,h=e.xScale,l=e.yScale,u=e.canvas;if(r||n){var f={x:t.offsetX,y:t.offsetY},p=u.get("canvasDOM");if(r){p.style.cursor="crosshair";var d=o.start,y=o.end,c=e.polygonPath,v=e.brushShape,g=e.container;e.plot&&e.inPlot&&(f=e._limitCoordScope(f));var x=void 0,m=void 0,b=void 0,M=void 0;"Y"===i?(x=d.x,m=f.y>=s.y?s.y:f.y,b=Math.abs(d.x-y.x),M=Math.abs(s.y-f.y)):"X"===i?(x=f.x>=s.x?s.x:f.x,m=y.y,b=Math.abs(s.x-f.x),M=Math.abs(y.y-d.y)):"XY"===i?(f.x>=s.x?(x=s.x,m=f.y>=s.y?s.y:f.y):(x=f.x,m=f.y>=s.y?s.y:f.y),b=Math.abs(s.x-f.x),M=Math.abs(s.y-f.y)):"POLYGON"===i&&(c+="L "+f.x+" "+f.y,e.polygonPath=c,v?!v.get("destroyed")&&v.attr(a.mix({},v.__attrs,{path:c})):v=g.addShape("path",{attrs:a.mix(e.style,{path:c})})),"POLYGON"!==i&&(v?!v.get("destroyed")&&v.attr(a.mix({},v.__attrs,{x:x,y:m,width:b,height:M})):v=g.addShape("rect",{attrs:a.mix(e.style,{x:x,y:m,width:b,height:M})})),e.brushShape=v}else if(n){p.style.cursor="move";var _=e.selection;if(_&&!_.get("destroyed"))if("POLYGON"===i){var O=e.prePoint;e.selection.translate(f.x-O.x,f.y-O.y)}else e.dragoffX&&_.attr("x",f.x-e.dragoffX),e.dragoffY&&_.attr("y",f.y-e.dragoffY)}e.prePoint=f,u.draw();var Y=e._getSelected(),S=Y.data,P=Y.shapes,L=Y.xValues,w=Y.yValues,D={data:S,shapes:P,x:f.x,y:f.y};h&&(D[h.field]=L),l&&(D[l.field]=w),e.onDragmove&&e.onDragmove(D),e.onBrushmove&&e.onBrushmove(D)}},t.prototype._onCanvasMouseUp=function(t){var e=this,r=e.data,n=e.shapes,i=e.xValues,o=e.yValues,s=e.canvas,h=e.type,l=e.startPoint,u=e.chart,f=e.container,p=e.xScale,d=e.yScale,y=t.offsetX,c=t.offsetY;if(s.get("canvasDOM").style.cursor="default",Math.abs(l.x-y)<=1&&Math.abs(l.y-c)<=1)return e.brushing=!1,void(e.dragging=!1);var v={data:r,shapes:n,x:y,y:c};if(p&&(v[p.field]=i),d&&(v[d.field]=o),e.dragging)e.dragging=!1,e.onDragend&&e.onDragend(v);else if(e.brushing){e.brushing=!1;var g=e.brushShape,x=e.polygonPath;"POLYGON"===h&&(x+="z",g&&!g.get("destroyed")&&g.attr(a.mix({},g.__attrs,{path:x})),e.polygonPath=x,s.draw()),e.onBrushend?e.onBrushend(v):u&&e.filter&&(f.clear(),"X"===h?p&&u.filter(p.field,function(t){return i.indexOf(t)>-1}):"Y"===h?d&&u.filter(d.field,function(t){return o.indexOf(t)>-1}):(p&&u.filter(p.field,function(t){return i.indexOf(t)>-1}),d&&u.filter(d.field,function(t){return o.indexOf(t)>-1})),u.repaint())}},t.prototype.setType=function(t){t&&(this.type=t.toUpperCase())},t.prototype.destroy=function(){this.clearEvents()},t.prototype._limitCoordScope=function(t){var e=this.plot,r=e.start,n=e.end;return t.x<r.x&&(t.x=r.x),t.x>n.x&&(t.x=n.x),t.y<n.y&&(t.y=n.y),t.y>r.y&&(t.y=r.y),t},t.prototype._getSelected=function(){var t=this.chart,e=this.xScale,r=this.yScale,n=this.brushShape,a=this.canvas.get("pixelRatio"),i=[],o=[],s=[],h=[];return t&&t.get("geoms").map(function(t){return t.getShapes().map(function(t){var l=t.get("origin");return Array.isArray(l)||(l=[l]),l.map(function(l){if(n.isHit(l.x*a,l.y*a)){i.push(t);var u=l._origin;h.push(u),e&&o.push(u[e.field]),r&&s.push(u[r.field])}return l}),t}),t}),this.shapes=i,this.xValues=o,this.yValues=s,this.data=h,{data:h,xValues:o,yValues:s,shapes:i}},t}();t.exports=o},function(t,e){function r(t,e){for(var r in e)e.hasOwnProperty(r)&&"constructor"!==r&&void 0!==e[r]&&(t[r]=e[r])}var n={mix:function(t,e,n,a){return e&&r(t,e),n&&r(t,n),a&&r(t,a),t},addEventListener:function(t,e,r){return t.addEventListener?(t.addEventListener(e,r,!1),{remove:function(){t.removeEventListener(e,r,!1)}}):t.attachEvent?(t.attachEvent("on"+e,r),{remove:function(){t.detachEvent("on"+e,r)}}):void 0},wrapBehavior:function(t,e){if(t["_wrap_"+e])return t["_wrap_"+e];var r=function(r){t[e](r)};return t["_wrap_"+e]=r,r},getWrapBehavior:function(t,e){return t["_wrap_"+e]}};t.exports=n}])});