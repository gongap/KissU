/* tslint:disable:no-non-null-assertion */
import { __generator, __read, __spread } from "tslib";
import compare from 'just-compare';
var ListNode = /** @class */ (function () {
    function ListNode(value) {
        this.value = value;
    }
    return ListNode;
}());
export { ListNode };
var LinkedList = /** @class */ (function () {
    function LinkedList() {
        this.size = 0;
    }
    Object.defineProperty(LinkedList.prototype, "head", {
        get: function () {
            return this.first;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LinkedList.prototype, "tail", {
        get: function () {
            return this.last;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(LinkedList.prototype, "length", {
        get: function () {
            return this.size;
        },
        enumerable: true,
        configurable: true
    });
    LinkedList.prototype.attach = function (value, previousNode, nextNode) {
        if (!previousNode)
            return this.addHead(value);
        if (!nextNode)
            return this.addTail(value);
        var node = new ListNode(value);
        node.previous = previousNode;
        previousNode.next = node;
        node.next = nextNode;
        nextNode.previous = node;
        this.size++;
        return node;
    };
    LinkedList.prototype.attachMany = function (values, previousNode, nextNode) {
        if (!values.length)
            return [];
        if (!previousNode)
            return this.addManyHead(values);
        if (!nextNode)
            return this.addManyTail(values);
        var list = new LinkedList();
        list.addManyTail(values);
        list.first.previous = previousNode;
        previousNode.next = list.first;
        list.last.next = nextNode;
        nextNode.previous = list.last;
        this.size += values.length;
        return list.toNodeArray();
    };
    LinkedList.prototype.detach = function (node) {
        if (!node.previous)
            return this.dropHead();
        if (!node.next)
            return this.dropTail();
        node.previous.next = node.next;
        node.next.previous = node.previous;
        this.size--;
        return node;
    };
    LinkedList.prototype.add = function (value) {
        var _this = this;
        return {
            after: function () {
                var _a;
                var params = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    params[_i] = arguments[_i];
                }
                return (_a = _this.addAfter).call.apply(_a, __spread([_this, value], params));
            },
            before: function () {
                var _a;
                var params = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    params[_i] = arguments[_i];
                }
                return (_a = _this.addBefore).call.apply(_a, __spread([_this, value], params));
            },
            byIndex: function (position) { return _this.addByIndex(value, position); },
            head: function () { return _this.addHead(value); },
            tail: function () { return _this.addTail(value); },
        };
    };
    LinkedList.prototype.addMany = function (values) {
        var _this = this;
        return {
            after: function () {
                var _a;
                var params = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    params[_i] = arguments[_i];
                }
                return (_a = _this.addManyAfter).call.apply(_a, __spread([_this, values], params));
            },
            before: function () {
                var _a;
                var params = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    params[_i] = arguments[_i];
                }
                return (_a = _this.addManyBefore).call.apply(_a, __spread([_this, values], params));
            },
            byIndex: function (position) { return _this.addManyByIndex(values, position); },
            head: function () { return _this.addManyHead(values); },
            tail: function () { return _this.addManyTail(values); },
        };
    };
    LinkedList.prototype.addAfter = function (value, previousValue, compareFn) {
        if (compareFn === void 0) { compareFn = compare; }
        var previous = this.find(function (node) { return compareFn(node.value, previousValue); });
        return previous ? this.attach(value, previous, previous.next) : this.addTail(value);
    };
    LinkedList.prototype.addBefore = function (value, nextValue, compareFn) {
        if (compareFn === void 0) { compareFn = compare; }
        var next = this.find(function (node) { return compareFn(node.value, nextValue); });
        return next ? this.attach(value, next.previous, next) : this.addHead(value);
    };
    LinkedList.prototype.addByIndex = function (value, position) {
        if (position < 0)
            position += this.size;
        else if (position >= this.size)
            return this.addTail(value);
        if (position <= 0)
            return this.addHead(value);
        var next = this.get(position);
        return this.attach(value, next.previous, next);
    };
    LinkedList.prototype.addHead = function (value) {
        var node = new ListNode(value);
        node.next = this.first;
        if (this.first)
            this.first.previous = node;
        else
            this.last = node;
        this.first = node;
        this.size++;
        return node;
    };
    LinkedList.prototype.addTail = function (value) {
        var node = new ListNode(value);
        if (this.first) {
            node.previous = this.last;
            this.last.next = node;
            this.last = node;
        }
        else {
            this.first = node;
            this.last = node;
        }
        this.size++;
        return node;
    };
    LinkedList.prototype.addManyAfter = function (values, previousValue, compareFn) {
        if (compareFn === void 0) { compareFn = compare; }
        var previous = this.find(function (node) { return compareFn(node.value, previousValue); });
        return previous ? this.attachMany(values, previous, previous.next) : this.addManyTail(values);
    };
    LinkedList.prototype.addManyBefore = function (values, nextValue, compareFn) {
        if (compareFn === void 0) { compareFn = compare; }
        var next = this.find(function (node) { return compareFn(node.value, nextValue); });
        return next ? this.attachMany(values, next.previous, next) : this.addManyHead(values);
    };
    LinkedList.prototype.addManyByIndex = function (values, position) {
        if (position < 0)
            position += this.size;
        if (position <= 0)
            return this.addManyHead(values);
        if (position >= this.size)
            return this.addManyTail(values);
        var next = this.get(position);
        return this.attachMany(values, next.previous, next);
    };
    LinkedList.prototype.addManyHead = function (values) {
        var _this = this;
        return values.reduceRight(function (nodes, value) {
            nodes.unshift(_this.addHead(value));
            return nodes;
        }, []);
    };
    LinkedList.prototype.addManyTail = function (values) {
        var _this = this;
        return values.map(function (value) { return _this.addTail(value); });
    };
    LinkedList.prototype.drop = function () {
        var _this = this;
        return {
            byIndex: function (position) { return _this.dropByIndex(position); },
            byValue: function () {
                var params = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    params[_i] = arguments[_i];
                }
                return _this.dropByValue.apply(_this, params);
            },
            byValueAll: function () {
                var params = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    params[_i] = arguments[_i];
                }
                return _this.dropByValueAll.apply(_this, params);
            },
            head: function () { return _this.dropHead(); },
            tail: function () { return _this.dropTail(); },
        };
    };
    LinkedList.prototype.dropMany = function (count) {
        var _this = this;
        return {
            byIndex: function (position) { return _this.dropManyByIndex(count, position); },
            head: function () { return _this.dropManyHead(count); },
            tail: function () { return _this.dropManyTail(count); },
        };
    };
    LinkedList.prototype.dropByIndex = function (position) {
        if (position < 0)
            position += this.size;
        var current = this.get(position);
        return current ? this.detach(current) : undefined;
    };
    LinkedList.prototype.dropByValue = function (value, compareFn) {
        if (compareFn === void 0) { compareFn = compare; }
        var position = this.findIndex(function (node) { return compareFn(node.value, value); });
        return position < 0 ? undefined : this.dropByIndex(position);
    };
    LinkedList.prototype.dropByValueAll = function (value, compareFn) {
        if (compareFn === void 0) { compareFn = compare; }
        var dropped = [];
        for (var current = this.first, position = 0; current; position++, current = current.next) {
            if (compareFn(current.value, value)) {
                dropped.push(this.dropByIndex(position - dropped.length));
            }
        }
        return dropped;
    };
    LinkedList.prototype.dropHead = function () {
        var head = this.first;
        if (head) {
            this.first = head.next;
            if (this.first)
                this.first.previous = undefined;
            else
                this.last = undefined;
            this.size--;
            return head;
        }
        return undefined;
    };
    LinkedList.prototype.dropTail = function () {
        var tail = this.last;
        if (tail) {
            this.last = tail.previous;
            if (this.last)
                this.last.next = undefined;
            else
                this.first = undefined;
            this.size--;
            return tail;
        }
        return undefined;
    };
    LinkedList.prototype.dropManyByIndex = function (count, position) {
        if (count <= 0)
            return [];
        if (position < 0)
            position = Math.max(position + this.size, 0);
        else if (position >= this.size)
            return [];
        count = Math.min(count, this.size - position);
        var dropped = [];
        while (count--) {
            var current = this.get(position);
            dropped.push(this.detach(current));
        }
        return dropped;
    };
    LinkedList.prototype.dropManyHead = function (count) {
        if (count <= 0)
            return [];
        count = Math.min(count, this.size);
        var dropped = [];
        while (count--)
            dropped.unshift(this.dropHead());
        return dropped;
    };
    LinkedList.prototype.dropManyTail = function (count) {
        if (count <= 0)
            return [];
        count = Math.min(count, this.size);
        var dropped = [];
        while (count--)
            dropped.push(this.dropTail());
        return dropped;
    };
    LinkedList.prototype.find = function (predicate) {
        for (var current = this.first, position = 0; current; position++, current = current.next) {
            if (predicate(current, position, this))
                return current;
        }
        return undefined;
    };
    LinkedList.prototype.findIndex = function (predicate) {
        for (var current = this.first, position = 0; current; position++, current = current.next) {
            if (predicate(current, position, this))
                return position;
        }
        return -1;
    };
    LinkedList.prototype.forEach = function (iteratorFn) {
        for (var node = this.first, position = 0; node; position++, node = node.next) {
            iteratorFn(node, position, this);
        }
    };
    LinkedList.prototype.get = function (position) {
        return this.find(function (_, index) { return position === index; });
    };
    LinkedList.prototype.indexOf = function (value, compareFn) {
        if (compareFn === void 0) { compareFn = compare; }
        return this.findIndex(function (node) { return compareFn(node.value, value); });
    };
    LinkedList.prototype.toArray = function () {
        var array = new Array(this.size);
        this.forEach(function (node, index) { return (array[index] = node.value); });
        return array;
    };
    LinkedList.prototype.toNodeArray = function () {
        var array = new Array(this.size);
        this.forEach(function (node, index) { return (array[index] = node); });
        return array;
    };
    LinkedList.prototype.toString = function (mapperFn) {
        if (mapperFn === void 0) { mapperFn = JSON.stringify; }
        return this.toArray()
            .map(function (value) { return mapperFn(value); })
            .join(' <-> ');
    };
    // Cannot use Generator type because of ng-packagr
    LinkedList.prototype[Symbol.iterator] = function () {
        var node, position;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    node = this.first, position = 0;
                    _a.label = 1;
                case 1:
                    if (!node) return [3 /*break*/, 4];
                    return [4 /*yield*/, node.value];
                case 2:
                    _a.sent();
                    _a.label = 3;
                case 3:
                    position++, node = node.next;
                    return [3 /*break*/, 1];
                case 4: return [2 /*return*/];
            }
        });
    };
    return LinkedList;
}());
export { LinkedList };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlua2VkLWxpc3QuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWJwL3V0aWxzLyIsInNvdXJjZXMiOlsibGliL2xpbmtlZC1saXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDBDQUEwQzs7QUFFMUMsT0FBTyxPQUFPLE1BQU0sY0FBYyxDQUFDO0FBRW5DO0lBR0Usa0JBQTRCLEtBQVE7UUFBUixVQUFLLEdBQUwsS0FBSyxDQUFHO0lBQUcsQ0FBQztJQUMxQyxlQUFDO0FBQUQsQ0FBQyxBQUpELElBSUM7O0FBRUQ7SUFBQTtRQUdVLFNBQUksR0FBRyxDQUFDLENBQUM7SUErWG5CLENBQUM7SUE3WEMsc0JBQUksNEJBQUk7YUFBUjtZQUNFLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztRQUNwQixDQUFDOzs7T0FBQTtJQUNELHNCQUFJLDRCQUFJO2FBQVI7WUFDRSxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDbkIsQ0FBQzs7O09BQUE7SUFDRCxzQkFBSSw4QkFBTTthQUFWO1lBQ0UsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ25CLENBQUM7OztPQUFBO0lBRU8sMkJBQU0sR0FBZCxVQUNFLEtBQVEsRUFDUixZQUFxQyxFQUNyQyxRQUFpQztRQUVqQyxJQUFJLENBQUMsWUFBWTtZQUFFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUU5QyxJQUFJLENBQUMsUUFBUTtZQUFFLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUUxQyxJQUFNLElBQUksR0FBRyxJQUFJLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsUUFBUSxHQUFHLFlBQVksQ0FBQztRQUM3QixZQUFZLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUN6QixJQUFJLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztRQUNyQixRQUFRLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUV6QixJ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QkFBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQWxCOzs7OztvQkFDVyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxRQUFRLEdBQUcsQ0FBQzs7O3lCQUFFLElBQUk7b0JBQzVDLHFCQUFNLElBQUksQ0FBQyxLQUFLLEVBQUE7O29CQUFoQixTQUFnQixDQUFDOzs7b0JBRDZCLFFBQVEsRUFBRSxFQUFFLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFBOzs7OztLQUc3RTtJQUNILGlCQUFDO0FBQUQsQ0FBQyxBQWxZRCxJQWtZQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIHRzbGludDpkaXNhYmxlOm5vLW5vbi1udWxsLWFzc2VydGlvbiAqL1xyXG5cclxuaW1wb3J0IGNvbXBhcmUgZnJvbSAnanVzdC1jb21wYXJlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBMaXN0Tm9kZTxUID0gYW55PiB7XHJcbiAgbmV4dDogTGlzdE5vZGUgfCB1bmRlZmluZWQ7XHJcbiAgcHJldmlvdXM6IExpc3ROb2RlIHwgdW5kZWZpbmVkO1xyXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyByZWFkb25seSB2YWx1ZTogVCkge31cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIExpbmtlZExpc3Q8VCA9IGFueT4ge1xyXG4gIHByaXZhdGUgZmlyc3Q6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkO1xyXG4gIHByaXZhdGUgbGFzdDogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQ7XHJcbiAgcHJpdmF0ZSBzaXplID0gMDtcclxuXHJcbiAgZ2V0IGhlYWQoKTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXMuZmlyc3Q7XHJcbiAgfVxyXG4gIGdldCB0YWlsKCk6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkIHtcclxuICAgIHJldHVybiB0aGlzLmxhc3Q7XHJcbiAgfVxyXG4gIGdldCBsZW5ndGgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLnNpemU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGF0dGFjaChcclxuICAgIHZhbHVlOiBULFxyXG4gICAgcHJldmlvdXNOb2RlOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZCxcclxuICAgIG5leHROb2RlOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZCxcclxuICApOiBMaXN0Tm9kZTxUPiB7XHJcbiAgICBpZiAoIXByZXZpb3VzTm9kZSkgcmV0dXJuIHRoaXMuYWRkSGVhZCh2YWx1ZSk7XHJcblxyXG4gICAgaWYgKCFuZXh0Tm9kZSkgcmV0dXJuIHRoaXMuYWRkVGFpbCh2YWx1ZSk7XHJcblxyXG4gICAgY29uc3Qgbm9kZSA9IG5ldyBMaXN0Tm9kZSh2YWx1ZSk7XHJcbiAgICBub2RlLnByZXZpb3VzID0gcHJldmlvdXNOb2RlO1xyXG4gICAgcHJldmlvdXNOb2RlLm5leHQgPSBub2RlO1xyXG4gICAgbm9kZS5uZXh0ID0gbmV4dE5vZGU7XHJcbiAgICBuZXh0Tm9kZS5wcmV2aW91cyA9IG5vZGU7XHJcblxyXG4gICAgdGhpcy5zaXplKys7XHJcblxyXG4gICAgcmV0dXJuIG5vZGU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGF0dGFjaE1hbnkoXHJcbiAgICB2YWx1ZXM6IFRbXSxcclxuICAgIHByZXZpb3VzTm9kZTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQsXHJcbiAgICBuZXh0Tm9kZTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQsXHJcbiAgKTogTGlzdE5vZGU8VD5bXSB7XHJcbiAgICBpZiAoIXZhbHVlcy5sZW5ndGgpIHJldHVybiBbXTtcclxuXHJcbiAgICBpZiAoIXByZXZpb3VzTm9kZSkgcmV0dXJuIHRoaXMuYWRkTWFueUhlYWQodmFsdWVzKTtcclxuXHJcbiAgICBpZiAoIW5leHROb2RlKSByZXR1cm4gdGhpcy5hZGRNYW55VGFpbCh2YWx1ZXMpO1xyXG5cclxuICAgIGNvbnN0IGxpc3QgPSBuZXcgTGlua2VkTGlzdDxUPigpO1xyXG4gICAgbGlzdC5hZGRNYW55VGFpbCh2YWx1ZXMpO1xyXG4gICAgbGlzdC5maXJzdCEucHJldmlvdXMgPSBwcmV2aW91c05vZGU7XHJcbiAgICBwcmV2aW91c05vZGUubmV4dCA9IGxpc3QuZmlyc3Q7XHJcbiAgICBsaXN0Lmxhc3QhLm5leHQgPSBuZXh0Tm9kZTtcclxuICAgIG5leHROb2RlLnByZXZpb3VzID0gbGlzdC5sYXN0O1xyXG5cclxuICAgIHRoaXMuc2l6ZSArPSB2YWx1ZXMubGVuZ3RoO1xyXG5cclxuICAgIHJldHVybiBsaXN0LnRvTm9kZUFycmF5KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGRldGFjaChub2RlOiBMaXN0Tm9kZTxUPikge1xyXG4gICAgaWYgKCFub2RlLnByZXZpb3VzKSByZXR1cm4gdGhpcy5kcm9wSGVhZCgpO1xyXG5cclxuICAgIGlmICghbm9kZS5uZXh0KSByZXR1cm4gdGhpcy5kcm9wVGFpbCgpO1xyXG5cclxuICAgIG5vZGUucHJldmlvdXMubmV4dCA9IG5vZGUubmV4dDtcclxuICAgIG5vZGUubmV4dC5wcmV2aW91cyA9IG5vZGUucHJldmlvdXM7XHJcblxyXG4gICAgdGhpcy5zaXplLS07XHJcblxyXG4gICAgcmV0dXJuIG5vZGU7XHJcbiAgfVxyXG5cclxuICBhZGQodmFsdWU6IFQpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGFmdGVyOiAoLi4ucGFyYW1zOiBbVF0gfCBbYW55LCBMaXN0Q29tcGFyaXNvbkZuPFQ+XSkgPT5cclxuICAgICAgICB0aGlzLmFkZEFmdGVyLmNhbGwodGhpcywgdmFsdWUsIC4uLnBhcmFtcyksXHJcbiAgICAgIGJlZm9yZTogKC4uLnBhcmFtczogW1RdIHwgW2FueSwgTGlzdENvbXBhcmlzb25GbjxUPl0pID0+XHJcbiAgICAgICAgdGhpcy5hZGRCZWZvcmUuY2FsbCh0aGlzLCB2YWx1ZSwgLi4ucGFyYW1zKSxcclxuICAgICAgYnlJbmRleDogKHBvc2l0aW9uOiBudW1iZXIpID0+IHRoaXMuYWRkQnlJbmRleCh2YWx1ZSwgcG9zaXRpb24pLFxyXG4gICAgICBoZWFkOiAoKSA9PiB0aGlzLmFkZEhlYWQodmFsdWUpLFxyXG4gICAgICB0YWlsOiAoKSA9PiB0aGlzLmFkZFRhaWwodmFsdWUpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFkZE1hbnkodmFsdWVzOiBUW10pIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGFmdGVyOiAoLi4ucGFyYW1zOiBbVF0gfCBbYW55LCBMaXN0Q29tcGFyaXNvbkZuPFQ+XSkgPT5cclxuICAgICAgICB0aGlzLmFkZE1hbnlBZnRlci5jYWxsKHRoaXMsIHZhbHVlcywgLi4ucGFyYW1zKSxcclxuICAgICAgYmVmb3JlOiAoLi4ucGFyYW1zOiBbVF0gfCBbYW55LCBMaXN0Q29tcGFyaXNvbkZuPFQ+XSkgPT5cclxuICAgICAgICB0aGlzLmFkZE1hbnlCZWZvcmUuY2FsbCh0aGlzLCB2YWx1ZXMsIC4uLnBhcmFtcyksXHJcbiAgICAgIGJ5SW5kZXg6IChwb3NpdGlvbjogbnVtYmVyKSA9PiB0aGlzLmFkZE1hbnlCeUluZGV4KHZhbHVlcywgcG9zaXRpb24pLFxyXG4gICAgICBoZWFkOiAoKSA9PiB0aGlzLmFkZE1hbnlIZWFkKHZhbHVlcyksXHJcbiAgICAgIHRhaWw6ICgpID0+IHRoaXMuYWRkTWFueVRhaWwodmFsdWVzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhZGRBZnRlcih2YWx1ZTogVCwgcHJldmlvdXNWYWx1ZTogVCk6IExpc3ROb2RlPFQ+O1xyXG4gIGFkZEFmdGVyKHZhbHVlOiBULCBwcmV2aW91c1ZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPik6IExpc3ROb2RlPFQ+O1xyXG4gIGFkZEFmdGVyKHZhbHVlOiBULCBwcmV2aW91c1ZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPiA9IGNvbXBhcmUpOiBMaXN0Tm9kZTxUPiB7XHJcbiAgICBjb25zdCBwcmV2aW91cyA9IHRoaXMuZmluZChub2RlID0+IGNvbXBhcmVGbihub2RlLnZhbHVlLCBwcmV2aW91c1ZhbHVlKSk7XHJcblxyXG4gICAgcmV0dXJuIHByZXZpb3VzID8gdGhpcy5hdHRhY2godmFsdWUsIHByZXZpb3VzLCBwcmV2aW91cy5uZXh0KSA6IHRoaXMuYWRkVGFpbCh2YWx1ZSk7XHJcbiAgfVxyXG5cclxuICBhZGRCZWZvcmUodmFsdWU6IFQsIG5leHRWYWx1ZTogVCk6IExpc3ROb2RlPFQ+O1xyXG4gIGFkZEJlZm9yZSh2YWx1ZTogVCwgbmV4dFZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPik6IExpc3ROb2RlPFQ+O1xyXG4gIGFkZEJlZm9yZSh2YWx1ZTogVCwgbmV4dFZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPiA9IGNvbXBhcmUpOiBMaXN0Tm9kZTxUPiB7XHJcbiAgICBjb25zdCBuZXh0ID0gdGhpcy5maW5kKG5vZGUgPT4gY29tcGFyZUZuKG5vZGUudmFsdWUsIG5leHRWYWx1ZSkpO1xyXG5cclxuICAgIHJldHVybiBuZXh0ID8gdGhpcy5hdHRhY2godmFsdWUsIG5leHQucHJldmlvdXMsIG5leHQpIDogdGhpcy5hZGRIZWFkKHZhbHVlKTtcclxuICB9XHJcblxyXG4gIGFkZEJ5SW5kZXgodmFsdWU6IFQsIHBvc2l0aW9uOiBudW1iZXIpOiBMaXN0Tm9kZTxUPiB7XHJcbiAgICBpZiAocG9zaXRpb24gPCAwKSBwb3NpdGlvbiArPSB0aGlzLnNpemU7XHJcbiAgICBlbHNlIGlmIChwb3NpdGlvbiA+PSB0aGlzLnNpemUpIHJldHVybiB0aGlzLmFkZFRhaWwodmFsdWUpO1xyXG5cclxuICAgIGlmIChwb3NpdGlvbiA8PSAwKSByZXR1cm4gdGhpcy5hZGRIZWFkKHZhbHVlKTtcclxuXHJcbiAgICBjb25zdCBuZXh0ID0gdGhpcy5nZXQocG9zaXRpb24pITtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5hdHRhY2godmFsdWUsIG5leHQucHJldmlvdXMsIG5leHQpO1xyXG4gIH1cclxuXHJcbiAgYWRkSGVhZCh2YWx1ZTogVCk6IExpc3ROb2RlPFQ+IHtcclxuICAgIGNvbnN0IG5vZGUgPSBuZXcgTGlzdE5vZGUodmFsdWUpO1xyXG5cclxuICAgIG5vZGUubmV4dCA9IHRoaXMuZmlyc3Q7XHJcblxyXG4gICAgaWYgKHRoaXMuZmlyc3QpIHRoaXMuZmlyc3QucHJldmlvdXMgPSBub2RlO1xyXG4gICAgZWxzZSB0aGlzLmxhc3QgPSBub2RlO1xyXG5cclxuICAgIHRoaXMuZmlyc3QgPSBub2RlO1xyXG4gICAgdGhpcy5zaXplKys7XHJcblxyXG4gICAgcmV0dXJuIG5vZGU7XHJcbiAgfVxyXG5cclxuICBhZGRUYWlsKHZhbHVlOiBUKTogTGlzdE5vZGU8VD4ge1xyXG4gICAgY29uc3Qgbm9kZSA9IG5ldyBMaXN0Tm9kZSh2YWx1ZSk7XHJcblxyXG4gICAgaWYgKHRoaXMuZmlyc3QpIHtcclxuICAgICAgbm9kZS5wcmV2aW91cyA9IHRoaXMubGFzdDtcclxuICAgICAgdGhpcy5sYXN0IS5uZXh0ID0gbm9kZTtcclxuICAgICAgdGhpcy5sYXN0ID0gbm9kZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuZmlyc3QgPSBub2RlO1xyXG4gICAgICB0aGlzLmxhc3QgPSBub2RlO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2l6ZSsrO1xyXG5cclxuICAgIHJldHVybiBub2RlO1xyXG4gIH1cclxuXHJcbiAgYWRkTWFueUFmdGVyKHZhbHVlczogVFtdLCBwcmV2aW91c1ZhbHVlOiBUKTogTGlzdE5vZGU8VD5bXTtcclxuICBhZGRNYW55QWZ0ZXIodmFsdWVzOiBUW10sIHByZXZpb3VzVmFsdWU6IGFueSwgY29tcGFyZUZuOiBMaXN0Q29tcGFyaXNvbkZuPFQ+KTogTGlzdE5vZGU8VD5bXTtcclxuICBhZGRNYW55QWZ0ZXIoXHJcbiAgICB2YWx1ZXM6IFRbXSxcclxuICAgIHByZXZpb3VzVmFsdWU6IGFueSxcclxuICAgIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPiA9IGNvbXBhcmUsXHJcbiAgKTogTGlzdE5vZGU8VD5bXSB7XHJcbiAgICBjb25zdCBwcmV2aW91cyA9IHRoaXMuZmluZChub2RlID0+IGNvbXBhcmVGbihub2RlLnZhbHVlLCBwcmV2aW91c1ZhbHVlKSk7XHJcblxyXG4gICAgcmV0dXJuIHByZXZpb3VzID8gdGhpcy5hdHRhY2hNYW55KHZhbHVlcywgcHJldmlvdXMsIHByZXZpb3VzLm5leHQpIDogdGhpcy5hZGRNYW55VGFpbCh2YWx1ZXMpO1xyXG4gIH1cclxuXHJcbiAgYWRkTWFueUJlZm9yZSh2YWx1ZXM6IFRbXSwgbmV4dFZhbHVlOiBUKTogTGlzdE5vZGU8VD5bXTtcclxuICBhZGRNYW55QmVmb3JlKHZhbHVlczogVFtdLCBuZXh0VmFsdWU6IGFueSwgY29tcGFyZUZuOiBMaXN0Q29tcGFyaXNvbkZuPFQ+KTogTGlzdE5vZGU8VD5bXTtcclxuICBhZGRNYW55QmVmb3JlKFxyXG4gICAgdmFsdWVzOiBUW10sXHJcbiAgICBuZXh0VmFsdWU6IGFueSxcclxuICAgIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPiA9IGNvbXBhcmUsXHJcbiAgKTogTGlzdE5vZGU8VD5bXSB7XHJcbiAgICBjb25zdCBuZXh0ID0gdGhpcy5maW5kKG5vZGUgPT4gY29tcGFyZUZuKG5vZGUudmFsdWUsIG5leHRWYWx1ZSkpO1xyXG5cclxuICAgIHJldHVybiBuZXh0ID8gdGhpcy5hdHRhY2hNYW55KHZhbHVlcywgbmV4dC5wcmV2aW91cywgbmV4dCkgOiB0aGlzLmFkZE1hbnlIZWFkKHZhbHVlcyk7XHJcbiAgfVxyXG5cclxuICBhZGRNYW55QnlJbmRleCh2YWx1ZXM6IFRbXSwgcG9zaXRpb246IG51bWJlcik6IExpc3ROb2RlPFQ+W10ge1xyXG4gICAgaWYgKHBvc2l0aW9uIDwgMCkgcG9zaXRpb24gKz0gdGhpcy5zaXplO1xyXG5cclxuICAgIGlmIChwb3NpdGlvbiA8PSAwKSByZXR1cm4gdGhpcy5hZGRNYW55SGVhZCh2YWx1ZXMpO1xyXG5cclxuICAgIGlmIChwb3NpdGlvbiA+PSB0aGlzLnNpemUpIHJldHVybiB0aGlzLmFkZE1hbnlUYWlsKHZhbHVlcyk7XHJcblxyXG4gICAgY29uc3QgbmV4dCA9IHRoaXMuZ2V0KHBvc2l0aW9uKSE7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuYXR0YWNoTWFueSh2YWx1ZXMsIG5leHQucHJldmlvdXMsIG5leHQpO1xyXG4gIH1cclxuXHJcbiAgYWRkTWFueUhlYWQodmFsdWVzOiBUW10pOiBMaXN0Tm9kZTxUPltdIHtcclxuICAgIHJldHVybiB2YWx1ZXMucmVkdWNlUmlnaHQ8TGlzdE5vZGU8VD5bXT4oKG5vZGVzLCB2YWx1ZSkgPT4ge1xyXG4gICAgICBub2Rlcy51bnNoaWZ0KHRoaXMuYWRkSGVhZCh2YWx1ZSkpO1xyXG4gICAgICByZXR1cm4gbm9kZXM7XHJcbiAgICB9LCBbXSk7XHJcbiAgfVxyXG5cclxuICBhZGRNYW55VGFpbCh2YWx1ZXM6IFRbXSk6IExpc3ROb2RlPFQ+W10ge1xyXG4gICAgcmV0dXJuIHZhbHVlcy5tYXAodmFsdWUgPT4gdGhpcy5hZGRUYWlsKHZhbHVlKSk7XHJcbiAgfVxyXG5cclxuICBkcm9wKCkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYnlJbmRleDogKHBvc2l0aW9uOiBudW1iZXIpID0+IHRoaXMuZHJvcEJ5SW5kZXgocG9zaXRpb24pLFxyXG4gICAgICBieVZhbHVlOiAoLi4ucGFyYW1zOiBbVF0gfCBbYW55LCBMaXN0Q29tcGFyaXNvbkZuPFQ+XSkgPT5cclxuICAgICAgICB0aGlzLmRyb3BCeVZhbHVlLmFwcGx5KHRoaXMsIHBhcmFtcyksXHJcbiAgICAgIGJ5VmFsdWVBbGw6ICguLi5wYXJhbXM6IFtUXSB8IFthbnksIExpc3RDb21wYXJpc29uRm48VD5dKSA9PlxyXG4gICAgICAgIHRoaXMuZHJvcEJ5VmFsdWVBbGwuYXBwbHkodGhpcywgcGFyYW1zKSxcclxuICAgICAgaGVhZDogKCkgPT4gdGhpcy5kcm9wSGVhZCgpLFxyXG4gICAgICB0YWlsOiAoKSA9PiB0aGlzLmRyb3BUYWlsKCksXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgZHJvcE1hbnkoY291bnQ6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgYnlJbmRleDogKHBvc2l0aW9uOiBudW1iZXIpID0+IHRoaXMuZHJvcE1hbnlCeUluZGV4KGNvdW50LCBwb3NpdGlvbiksXHJcbiAgICAgIGhlYWQ6ICgpID0+IHRoaXMuZHJvcE1hbnlIZWFkKGNvdW50KSxcclxuICAgICAgdGFpbDogKCkgPT4gdGhpcy5kcm9wTWFueVRhaWwoY291bnQpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGRyb3BCeUluZGV4KHBvc2l0aW9uOiBudW1iZXIpOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZCB7XHJcbiAgICBpZiAocG9zaXRpb24gPCAwKSBwb3NpdGlvbiArPSB0aGlzLnNpemU7XHJcblxyXG4gICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0KHBvc2l0aW9uKTtcclxuXHJcbiAgICByZXR1cm4gY3VycmVudCA/IHRoaXMuZGV0YWNoKGN1cnJlbnQpIDogdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgZHJvcEJ5VmFsdWUodmFsdWU6IFQpOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZDtcclxuICBkcm9wQnlWYWx1ZSh2YWx1ZTogYW55LCBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4pOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZDtcclxuICBkcm9wQnlWYWx1ZSh2YWx1ZTogYW55LCBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4gPSBjb21wYXJlKTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQge1xyXG4gICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLmZpbmRJbmRleChub2RlID0+IGNvbXBhcmVGbihub2RlLnZhbHVlLCB2YWx1ZSkpO1xyXG5cclxuICAgIHJldHVybiBwb3NpdGlvbiA8IDAgPyB1bmRlZmluZWQgOiB0aGlzLmRyb3BCeUluZGV4KHBvc2l0aW9uKTtcclxuICB9XHJcblxyXG4gIGRyb3BCeVZhbHVlQWxsKHZhbHVlOiBUKTogTGlzdE5vZGU8VD5bXTtcclxuICBkcm9wQnlWYWx1ZUFsbCh2YWx1ZTogYW55LCBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4pOiBMaXN0Tm9kZTxUPltdO1xyXG4gIGRyb3BCeVZhbHVlQWxsKHZhbHVlOiBhbnksIGNvbXBhcmVGbjogTGlzdENvbXBhcmlzb25GbjxUPiA9IGNvbXBhcmUpOiBMaXN0Tm9kZTxUPltdIHtcclxuICAgIGNvbnN0IGRyb3BwZWQ6IExpc3ROb2RlPFQ+W10gPSBbXTtcclxuXHJcbiAgICBmb3IgKGxldCBjdXJyZW50ID0gdGhpcy5maXJzdCwgcG9zaXRpb24gPSAwOyBjdXJyZW50OyBwb3NpdGlvbisrLCBjdXJyZW50ID0gY3VycmVudC5uZXh0KSB7XHJcbiAgICAgIGlmIChjb21wYXJlRm4oY3VycmVudC52YWx1ZSwgdmFsdWUpKSB7XHJcbiAgICAgICAgZHJvcHBlZC5wdXNoKHRoaXMuZHJvcEJ5SW5kZXgocG9zaXRpb24gLSBkcm9wcGVkLmxlbmd0aCkhKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkcm9wcGVkO1xyXG4gIH1cclxuXHJcbiAgZHJvcEhlYWQoKTogTGlzdE5vZGU8VD4gfCB1bmRlZmluZWQge1xyXG4gICAgY29uc3QgaGVhZCA9IHRoaXMuZmlyc3Q7XHJcblxyXG4gICAgaWYgKGhlYWQpIHtcclxuICAgICAgdGhpcy5maXJzdCA9IGhlYWQubmV4dDtcclxuXHJcbiAgICAgIGlmICh0aGlzLmZpcnN0KSB0aGlzLmZpcnN0LnByZXZpb3VzID0gdW5kZWZpbmVkO1xyXG4gICAgICBlbHNlIHRoaXMubGFzdCA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgIHRoaXMuc2l6ZS0tO1xyXG5cclxuICAgICAgcmV0dXJuIGhlYWQ7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIGRyb3BUYWlsKCk6IExpc3ROb2RlPFQ+IHwgdW5kZWZpbmVkIHtcclxuICAgIGNvbnN0IHRhaWwgPSB0aGlzLmxhc3Q7XHJcblxyXG4gICAgaWYgKHRhaWwpIHtcclxuICAgICAgdGhpcy5sYXN0ID0gdGFpbC5wcmV2aW91cztcclxuXHJcbiAgICAgIGlmICh0aGlzLmxhc3QpIHRoaXMubGFzdC5uZXh0ID0gdW5kZWZpbmVkO1xyXG4gICAgICBlbHNlIHRoaXMuZmlyc3QgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICB0aGlzLnNpemUtLTtcclxuXHJcbiAgICAgIHJldHVybiB0YWlsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBkcm9wTWFueUJ5SW5kZXgoY291bnQ6IG51bWJlciwgcG9zaXRpb246IG51bWJlcik6IExpc3ROb2RlPFQ+W10ge1xyXG4gICAgaWYgKGNvdW50IDw9IDApIHJldHVybiBbXTtcclxuXHJcbiAgICBpZiAocG9zaXRpb24gPCAwKSBwb3NpdGlvbiA9IE1hdGgubWF4KHBvc2l0aW9uICsgdGhpcy5zaXplLCAwKTtcclxuICAgIGVsc2UgaWYgKHBvc2l0aW9uID49IHRoaXMuc2l6ZSkgcmV0dXJuIFtdO1xyXG5cclxuICAgIGNvdW50ID0gTWF0aC5taW4oY291bnQsIHRoaXMuc2l6ZSAtIHBvc2l0aW9uKTtcclxuXHJcbiAgICBjb25zdCBkcm9wcGVkOiBMaXN0Tm9kZTxUPltdID0gW107XHJcblxyXG4gICAgd2hpbGUgKGNvdW50LS0pIHtcclxuICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuZ2V0KHBvc2l0aW9uKTtcclxuICAgICAgZHJvcHBlZC5wdXNoKHRoaXMuZGV0YWNoKGN1cnJlbnQhKSEpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBkcm9wcGVkO1xyXG4gIH1cclxuXHJcbiAgZHJvcE1hbnlIZWFkKGNvdW50OiBFeGNsdWRlPG51bWJlciwgMD4pOiBMaXN0Tm9kZTxUPltdIHtcclxuICAgIGlmIChjb3VudCA8PSAwKSByZXR1cm4gW107XHJcblxyXG4gICAgY291bnQgPSBNYXRoLm1pbihjb3VudCwgdGhpcy5zaXplKTtcclxuXHJcbiAgICBjb25zdCBkcm9wcGVkOiBMaXN0Tm9kZTxUPltdID0gW107XHJcblxyXG4gICAgd2hpbGUgKGNvdW50LS0pIGRyb3BwZWQudW5zaGlmdCh0aGlzLmRyb3BIZWFkKCkhKTtcclxuXHJcbiAgICByZXR1cm4gZHJvcHBlZDtcclxuICB9XHJcblxyXG4gIGRyb3BNYW55VGFpbChjb3VudDogRXhjbHVkZTxudW1iZXIsIDA+KTogTGlzdE5vZGU8VD5bXSB7XHJcbiAgICBpZiAoY291bnQgPD0gMCkgcmV0dXJuIFtdO1xyXG5cclxuICAgIGNvdW50ID0gTWF0aC5taW4oY291bnQsIHRoaXMuc2l6ZSk7XHJcblxyXG4gICAgY29uc3QgZHJvcHBlZDogTGlzdE5vZGU8VD5bXSA9IFtdO1xyXG5cclxuICAgIHdoaWxlIChjb3VudC0tKSBkcm9wcGVkLnB1c2godGhpcy5kcm9wVGFpbCgpISk7XHJcblxyXG4gICAgcmV0dXJuIGRyb3BwZWQ7XHJcbiAgfVxyXG5cclxuICBmaW5kKHByZWRpY2F0ZTogTGlzdEl0ZXJhdG9yRm48VD4pOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZCB7XHJcbiAgICBmb3IgKGxldCBjdXJyZW50ID0gdGhpcy5maXJzdCwgcG9zaXRpb24gPSAwOyBjdXJyZW50OyBwb3NpdGlvbisrLCBjdXJyZW50ID0gY3VycmVudC5uZXh0KSB7XHJcbiAgICAgIGlmIChwcmVkaWNhdGUoY3VycmVudCwgcG9zaXRpb24sIHRoaXMpKSByZXR1cm4gY3VycmVudDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgZmluZEluZGV4KHByZWRpY2F0ZTogTGlzdEl0ZXJhdG9yRm48VD4pOiBudW1iZXIge1xyXG4gICAgZm9yIChsZXQgY3VycmVudCA9IHRoaXMuZmlyc3QsIHBvc2l0aW9uID0gMDsgY3VycmVudDsgcG9zaXRpb24rKywgY3VycmVudCA9IGN1cnJlbnQubmV4dCkge1xyXG4gICAgICBpZiAocHJlZGljYXRlKGN1cnJlbnQsIHBvc2l0aW9uLCB0aGlzKSkgcmV0dXJuIHBvc2l0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAtMTtcclxuICB9XHJcblxyXG4gIGZvckVhY2g8UiA9IGJvb2xlYW4+KGl0ZXJhdG9yRm46IExpc3RJdGVyYXRvckZuPFQsIFI+KSB7XHJcbiAgICBmb3IgKGxldCBub2RlID0gdGhpcy5maXJzdCwgcG9zaXRpb24gPSAwOyBub2RlOyBwb3NpdGlvbisrLCBub2RlID0gbm9kZS5uZXh0KSB7XHJcbiAgICAgIGl0ZXJhdG9yRm4obm9kZSwgcG9zaXRpb24sIHRoaXMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0KHBvc2l0aW9uOiBudW1iZXIpOiBMaXN0Tm9kZTxUPiB8IHVuZGVmaW5lZCB7XHJcbiAgICByZXR1cm4gdGhpcy5maW5kKChfLCBpbmRleCkgPT4gcG9zaXRpb24gPT09IGluZGV4KTtcclxuICB9XHJcblxyXG4gIGluZGV4T2YodmFsdWU6IFQpOiBudW1iZXI7XHJcbiAgaW5kZXhPZih2YWx1ZTogYW55LCBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4pOiBudW1iZXI7XHJcbiAgaW5kZXhPZih2YWx1ZTogYW55LCBjb21wYXJlRm46IExpc3RDb21wYXJpc29uRm48VD4gPSBjb21wYXJlKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmZpbmRJbmRleChub2RlID0+IGNvbXBhcmVGbihub2RlLnZhbHVlLCB2YWx1ZSkpO1xyXG4gIH1cclxuXHJcbiAgdG9BcnJheSgpOiBUW10ge1xyXG4gICAgY29uc3QgYXJyYXkgPSBuZXcgQXJyYXkodGhpcy5zaXplKTtcclxuXHJcbiAgICB0aGlzLmZvckVhY2goKG5vZGUsIGluZGV4KSA9PiAoYXJyYXlbaW5kZXghXSA9IG5vZGUudmFsdWUpKTtcclxuXHJcbiAgICByZXR1cm4gYXJyYXk7XHJcbiAgfVxyXG5cclxuICB0b05vZGVBcnJheSgpOiBMaXN0Tm9kZTxUPltdIHtcclxuICAgIGNvbnN0IGFycmF5ID0gbmV3IEFycmF5KHRoaXMuc2l6ZSk7XHJcblxyXG4gICAgdGhpcy5mb3JFYWNoKChub2RlLCBpbmRleCkgPT4gKGFycmF5W2luZGV4IV0gPSBub2RlKSk7XHJcblxyXG4gICAgcmV0dXJuIGFycmF5O1xyXG4gIH1cclxuXHJcbiAgdG9TdHJpbmcobWFwcGVyRm46IExpc3RNYXBwZXJGbjxUPiA9IEpTT04uc3RyaW5naWZ5KTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLnRvQXJyYXkoKVxyXG4gICAgICAubWFwKHZhbHVlID0+IG1hcHBlckZuKHZhbHVlKSlcclxuICAgICAgLmpvaW4oJyA8LT4gJyk7XHJcbiAgfVxyXG5cclxuICAvLyBDYW5ub3QgdXNlIEdlbmVyYXRvciB0eXBlIGJlY2F1c2Ugb2YgbmctcGFja2FnclxyXG4gICpbU3ltYm9sLml0ZXJhdG9yXSgpOiBhbnkge1xyXG4gICAgZm9yIChsZXQgbm9kZSA9IHRoaXMuZmlyc3QsIHBvc2l0aW9uID0gMDsgbm9kZTsgcG9zaXRpb24rKywgbm9kZSA9IG5vZGUubmV4dCkge1xyXG4gICAgICB5aWVsZCBub2RlLnZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IHR5cGUgTGlzdE1hcHBlckZuPFQgPSBhbnk+ID0gKHZhbHVlOiBUKSA9PiBhbnk7XHJcblxyXG5leHBvcnQgdHlwZSBMaXN0Q29tcGFyaXNvbkZuPFQgPSBhbnk+ID0gKHZhbHVlMTogVCwgdmFsdWUyOiBhbnkpID0+IGJvb2xlYW47XHJcblxyXG5leHBvcnQgdHlwZSBMaXN0SXRlcmF0b3JGbjxUID0gYW55LCBSID0gYm9vbGVhbj4gPSAoXHJcbiAgbm9kZTogTGlzdE5vZGU8VD4sXHJcbiAgaW5kZXg/OiBudW1iZXIsXHJcbiAgbGlzdD86IExpbmtlZExpc3QsXHJcbikgPT4gUjtcclxuIl19