version: '3.4'

# The default docker-compose.override file can use the "localhost" as the external name for testing web apps within the same dev machine. 
# The ESHOP_EXTERNAL_DNS_NAME_OR_IP environment variable is taken, by default, from the ".env" file defined like: 
#     ESHOP_EXTERNAL_DNS_NAME_OR_IP=localhost
# but values present in the environment vars at runtime will always override those defined inside the .env file
# An external IP or DNS name has to be used (instead localhost and the 10.0.75.1 IP) when testing the Web apps and the Xamarin apps from remote machines/devices using the same WiFi, for instance.

services:
  consul:
    ports:
      - "8500:8500"

  redis:
    ports:
      - "6379:6379"

  rabbitmq:
    ports:
      - "15672:15672"
      - "5672:5672"

  sqldata:
    environment:
      - SA_PASSWORD=saP@ss123
      - ACCEPT_EULA=Y
    ports:
      - "5433:1433"
    volumes:
      - kissu-sqldata:/var/opt/mssql

  identityserver:
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ASPNETCORE_URLS=http://0.0.0.0:80
    ports:
      - "8080:80"

  serviceshost:
    environment:
      - Server_IP=0.0.0.0
      - Server_Port=81
      - Mapping_ip=192.168.2.76
      - Mapping_port=81
      - Register_Conn=192.168.2.76:8500
      - EventBusConnection=192.168.2.76
      - HttpPort=8001
      - WSPort=8101
      - MQTTPort=8201
      - GrpcPort=8301
    volumes:
      - kissu-serviceshost:/home/gongap
    ports:
      - "81:81"
      - "8001:8001"
      - "8101:8101"
      - "8201:8201"
      - "8301:8301"

  serviceshost_a:
    environment:
      - Server_IP=0.0.0.0
      - Server_Port=82
      - Mapping_ip=192.168.2.76
      - Mapping_port=82
      - Register_Conn=192.168.2.76:8500
      - EventBusConnection=192.168.2.76
      - HttpPort=8002
      - WSPort=8102
      - MQTTPort=8202
      - GrpcPort=8302
    volumes:
      - kissu-serviceshost:/home/gongap
    ports:
      - "82:82"
      - "8002:8002"
      - "8102:8102"
      - "8202:8202"
      - "8302:8302"

volumes:
  kissu-sqldata:
    external: false
  kissu-serviceshost:
    external: false
